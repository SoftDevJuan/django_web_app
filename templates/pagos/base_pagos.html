{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CCL</title>
    
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css' rel='stylesheet'>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="{% static 'js/salasform.js' %}"></script>
    <link rel="icon" type="image/png" href="" />
    <style>
      body {
        background-color: #f8f9fa;
      }

      @import url("https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap");
      :root {
        --header-height: 3rem;
        --nav-width: 68px;
        --first-color: #0a1f8f;
        --first-color-light: #afa5d9;
        --white-color: #f7f6fb;
        --body-font: "Nunito", sans-serif;
        --normal-font-size: 1rem;
        --z-fixed: 100;
      }
      *,
      ::before,
      ::after {
        box-sizing: border-box;
      }
      body {
        position: relative;
        margin: var(--header-height) 0 0 0;
        padding: 0 1rem;
        font-family: var(--body-font);
        font-size: var(--normal-font-size);
        transition: 0.5s;
      }
      a {
        text-decoration: none;
      }
      .header {
        width: 100%;
        height: var(--header-height);
        position: fixed;
        top: 0;
        left: 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 1rem;
        background-color: none;
        z-index: var(--z-fixed);
        transition: 0.5s;
      }
      .header_toggle {
        color: var(--first-color);
        font-size: 1.5rem;
        cursor: pointer;
      }
      .header_img {
        width: 35px;
        height: 35px;
        display: flex;
        justify-content: center;
        border-radius: 50%;
        overflow: hidden;
      }
      .header_img img {
        width: 40px;
      }
      .l-navbar {
        position: fixed;
        top: 0;
        left: -30%;
        width: var(--nav-width);
        height: 100vh;
        background-color: var(--first-color);
        padding: 0.5rem 1rem 0 0;
        transition: 0.5s;
        z-index: var(--z-fixed);
      }
      .nav {
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        overflow: hidden;
      }
      .nav_logo,
      .nav_link {
        display: grid;
        grid-template-columns: max-content max-content;
        align-items: center;
        column-gap: 1rem;
        padding: 0.5rem 0 0.5rem 1.5rem;
      }
      .nav_logo {
        margin-bottom: 2rem;
      }
      .nav_logo-icon {
        width: 1.50rem;
        color: var(--white-color);
      }
      .nav_logo-name {
        color: var(--white-color);
        font-weight: 700;
      }
      .nav_link {
        position: relative;
        color: var(--first-color-light);
        margin-bottom: 1.5rem;
        transition: 0.3s;
      }
      .nav_link:hover {
        color: var(--white-color);
      }
      .nav_icon {
        font-size: 1.25rem;
      }
      .l-navbar.show {
        left: 0;
      }
      .body-pd {
        padding-left: calc(var(--nav-width) + 1rem);
      }
      .active {
        color: var(--white-color);
      }
      .active::before {
        content: "";
        position: absolute;
        left: 0;
        width: 2px;
        height: 32px;
        background-color: var(--white-color);
      }
      .height-100 {
        height: 100vh;
      }
      @media screen and (min-width: 768px) {
        body {
          margin: calc(var(--header-height) + 1rem) 0 0 0;
          padding-left: calc(var(--nav-width) + 2rem);
        }
        .header {
          height: calc(var(--header-height) + 1rem);
          padding: 0 2rem 0 calc(var(--nav-width) + 2rem);
        }
        .header_img {
          width: 40px;
          height: 40px;
        }
        .header_img img {
          width: 45px;
        }
        .l-navbar {
          left: 0;
          padding: 1rem 1rem 0 0;
        }
        .l-navbar.show {
          width: calc(var(--nav-width) + 156px);
        }
        .body-pd {
          padding-left: calc(var(--nav-width) + 188px);
        }
      }

      /* a {
        text-decoration: underline;
        color: #58151c;
      } */

      .card {
        border-radius: 10px;
      }

      .card-body h2 {
        font-size: 2.5rem;
      }

      .btn-primary {
        background-color: #d8defb;
        border-color: #d8defb;
        color: #555a7c;
      }

      .btn-warning {
        background-color: #f5e3d1;
        border-color: #f5e3d1;
        color: #816b4d;
      }

      .btn-danger {
        background-color: #f5b7b1;
        border-color: #f5b7b1;
        color: #783f3f;
      }

      .btn-success {
        background-color: #e6f9f7;
        border-color: #e6f9f7;
        color: #5a7d77;
      }

      .btn-dark {
        background-color: #5d6d7e;
        border-color: #5d6d7e;
        color: #fff;
      }

      .btn-secondary {
        background-color: #d5d8dc;
        border-color: #d5d8dc;
        color: #000;
      }

      .btn-sm {
        margin: 0 2px;
      }

      .group {
        display: flex;
        line-height: 28px;
        align-items: center;
        position: relative;
        width: 100%;
      }

      .input {
        width: 100%;
        height: 40px;
        line-height: 28px;
        padding: 0 1rem;
        padding-left: 2.5rem;
        border: 2px solid transparent;
        border-radius: 8px;
        outline: none;
        border-color: rgba(0, 21, 247, 0.084);
        background-color: #f3f3f4;
        color: #0d0c22;
        transition: 0.3s ease;
      }

      .input::placeholder {
        color: #9e9ea7;
      }

      .input:focus,
      input:hover {
        outline: none;
        border-color: rgba(0, 21, 247, 0.4);
        background-color: #fff;
        box-shadow: 0 0 0 4px rgba(8, 0, 247, 0.1);
      }

      .icon {
        position: absolute;
        left: 1rem;
        fill: #9e9ea7;
        width: 1rem;
        height: 1rem;
      }

      .blue-icon {
        color: #004a99;
      }

      .bg-blue {
        background-color: #004a99c6;
      }

      .close {
        display: none;
      }

      .d-flex-center {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .d-flex-center p {
        margin-bottom: 0;
      }

      .custom-width {
        max-width: 500px;
        margin: auto;
      }
      @media (min-width: 1770px) {
        .custom-width {
          width: 25%;
        }
      }
      .container-btn-file {
        display: flex;
        position: relative;
        justify-content: center;
        align-items: center;
        background-color: #307750;
        color: #fff;
        border-style: none;
        padding: 1em 2em;
        border-radius: 0.5em;
        overflow: hidden;
        z-index: 1;
        box-shadow: 4px 8px 10px -3px rgba(0, 0, 0, 0.356);
        transition: all 250ms;
      }
      .container-btn-file input[type="file"] {
        position: absolute;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
      }
      .container-btn-file > svg {
        margin-right: 1em;
      }
      .container-btn-file::before {
        content: "";
        position: absolute;
        height: 100%;
        width: 0;
        border-radius: 0.5em;
        background-color: #469b61;
        z-index: -1;
        transition: all 350ms;
      }
      .container-btn-file:hover::before {
        width: 100%;
      }
      .width-65 {
        width: 65%;
      }
      .counter-text{
        color: #a0a0a0;
      }
      .fc-col-header{
        background-color: #EAEEF4;
      }
      .fc .fc-col-header-cell-cushion {
        display: inline-block;
        padding: 2px 4px;
        color: #5A6A85;
      }
      .fc-col-header-cell{
        vertical-align: middle !important;
      }
      .fc .fc-daygrid-day.fc-day-today {
        background-color: transparent;
        padding: 3px;
        border-radius: 23px;
      }
      .fc .fc-daygrid-day.fc-day-today .fc-daygrid-day-frame {
        background-color: var(--bs-gray-200);
        border-radius: 7px;
      }
      .fc .fc-daygrid-day.fc-day-today .fc-daygrid-day-frame .fc-daygrid-day-number {
        font-size: 15px;
        font-weight: 800;
      }
      .fc-day.fc-day-today.fc-timegrid-col{
        background-color: var(--bs-gray-200) !important;
        border-radius: 7px !important;
      }
      .fc-timegrid-event-harness-inset .fc-timegrid-event, .fc-timegrid-event.fc-event-mirror, .fc-timegrid-more-link {
        box-shadow: none !important;
      }
      .fc-daygrid-day-number{
        color: #5A6A85;
      }
      .fc-today-button {
        background-color: var(--first-color) !important;
        color: white !important;
      }
      .fc-today-button:hover {
        background-color: var(--first-color) !important;
        border: var(--first-color-light);
      }
      .fc-prev-button, .fc-next-button{
        margin-inline-end: 0.3rem !important;
        background-color: #DFE5EF !important;
        border: none !important;
        color: #2A3547 !important;
      }
      .fc-dayGridMonth-button, .fc-timeGridWeek-button, .fc-timeGridDay-button, .fc-button-primary.fc-listWeek-button{
        background-color: #DFE5EF !important;
        border: none !important;
        color: #2A3547 !important;
      }
      .fc-button-active, .fc-button-primary.fc-listWeek-button.fc-button-active{
        background-color: #2A3547 !important;
        color: white !important;
      }
      .fc-col-header  {
        height: 56px !important;
      }
      .fc-event {
        border: none !important;
        background: transparent !important;
        margin-bottom: 2px !important;
      }
      .fc-event-main-frame {
        display: flex !important;
        align-items: center !important;
        border-radius: 0 20px 20px 0 !important;
        overflow: hidden !important;
      }
      .event-content {
        display: flex !important;
        align-items: center !important;
        width: 100% !important;
        padding: 3px 8px 3px 8px !important;
        border-style: solid !important;
        border-width: 0 0 0 4px !important;
        border-radius: 5px 20px 20px 5px !important;
        padding: 8px 10px !important; 
        font-size: 13px !important;
        font-weight: 500 !important;
        cursor: pointer !important;
      }
      .fc-event-title {
        font-weight: 600 !important;
      }
      .fc-event-time {
        margin-right: 4px !important;
      }
      h2{
        text-transform: uppercase;
        font-weight: bold;
      }
      .text-blue{
        color: var(--first-color);
      }
      .icono-rojo {
        color: red;
    }
    .icono-amarillo {
        color: yellow;
    }
    .icono-verde {
        color: green;
    }
    </style>
    {% load static %}
  </head>
  <body id="body-pd">
    <!-- Modal para cancelar pago -->
    <div
      class="modal fade"
      id="cancelModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header justify-content-center">
            <h1 class="modal-title fs-5" id="exampleModalLabel">
              ¿Cancelar pago?
            </h1>
          </div>
          <div class="modal-body text-center">
            Una vez cancelado el pago se perderá la información capturada,
            ¿realmente quiere hacer esto?
          </div>
          <div class="modal-footer justify-content-center">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              No, seguir con el registro
            </button>
            <form action="{% url 'cancelar_pago' %}" method="POST">
            {% csrf_token %}
            <button
              id="cancelButton"
              type="submit"
              class="btn btn-danger disabled"
              data-bs-dismiss="modal"
              onclick="redirigirATurnos()"
            >
              Sí, cancelar el pago (3s)
            </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    {% include 'general1/header.html' %} {% block content %}{% endblock %}

    <script>
      function redirigirATurnos() {
        window.location.href = "{% url 'VistaTurnosRecepcion' %}";
      }

      //Método para formatear y mostrar tiempo en frontend
      let intervalId;
      let tiempoInicial = 0;

      function formatearTiempo(segundos) {
        const horas = Math.floor(segundos / 3600);
        const minutos = Math.floor((segundos % 3600) / 60);
        const segs = segundos % 60;
        return `${horas.toString().padStart(2, "0")}:${minutos
          .toString()
          .padStart(2, "0")}:${segs.toString().padStart(2, "0")}`;
      }

      function actualizarTiempoTranscurrido() {
        fetch('{% url "atender_pagos" %}', {
          headers: {
            "X-Requested-With": "XMLHttpRequest",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            tiempoInicial = data.tiempo;
            actualizarDisplay();
          });
      }

      function actualizarDisplay() {
        const tiempoFormateado = formatearTiempo(tiempoInicial);
        document.getElementById(
          "tiempo-transcurrido"
        ).textContent = `Tiempo del turno transcurrido: ${tiempoFormateado}`;
        tiempoInicial++;
      }

      document.addEventListener("DOMContentLoaded", function (event) {
        const showNavbar = (toggleId, navId, bodyId, headerId) => {
          const toggle = document.getElementById(toggleId),
            nav = document.getElementById(navId),
            bodypd = document.getElementById(bodyId),
            headerpd = document.getElementById(headerId);

          // Validate that all variables exist
          if (toggle && nav && bodypd && headerpd) {
            toggle.addEventListener("click", () => {
              // show navbar
              nav.classList.toggle("show");
              // change icon
              toggle.classList.toggle("bx-x");
              // add padding to body
              bodypd.classList.toggle("body-pd");
              // add padding to header
              headerpd.classList.toggle("body-pd");
            });
          }
        };

        showNavbar("header-toggle", "nav-bar", "body-pd", "header");

        /*===== LINK ACTIVE =====*/
        const linkColor = document.querySelectorAll(".nav_link");

        function colorLink() {
          if (linkColor) {
            linkColor.forEach((l) => l.classList.remove("active"));
            this.classList.add("active");
          }
        }
        linkColor.forEach((l) => l.addEventListener("click", colorLink));

        const modal = document.getElementById("cancelModal");
        var paymentMethod = document.getElementById("paymentMethod");
        var methodOther = document.getElementById("methodOther");

        paymentMethod.addEventListener("change", function () {
          if (this.value === "3") {
            methodOther.classList.remove("d-none");
          } else {
            methodOther.classList.add("d-none");
          }
        });

        //Función para temporizador en modal de cancelar pago
        modal.addEventListener("shown.bs.modal", () => {
          cancelButton.classList.add("disabled");
          cancelButton.textContent = "Sí, cancelar el pago (3s)";

          let countdown = 3;
          const interval = setInterval(() => {
            countdown--;
            cancelButton.textContent = `Sí, cancelar el pago (${countdown}s)`;

            if (countdown === 0) {
              clearInterval(interval);
              cancelButton.classList.remove("disabled");
              cancelButton.textContent = "Sí, cancelar el pago";
            }
          }, 1000);
        });

        //Mostrar a para enviar documento si se carga
        var fileForm = document.getElementById("fileForm");
        var sendFile = document.getElementById("sendFile");
        fileForm.addEventListener("change", function () {
          if (this.files.length > 0) {
            sendFile.classList.remove("d-none");
          } else {
            sendFile.classList.add("d-none");
          }
        });

        //Llamar método para actualizar tiempo cada 1s
        actualizarTiempoTranscurrido();
        intervalId = setInterval(actualizarDisplay, 1000);
      });

//scripts sebas
//Modal editar sala
document.addEventListener("DOMContentLoaded", function() {
    var modalEdit = document.getElementById('modalFormEdit');
    modalEdit.addEventListener('show.bs.modal', function(event) {
        var button = event.relatedTarget;
        var salaId = button.getAttribute('data-sala-id');
        var salaName = button.getAttribute('data-sala-name');
        var conciliadorId = button.getAttribute('data-conciliador-id');

        var modalSalaId = modalEdit.querySelector('#sala-id');
        var modalRoomName = modalEdit.querySelector('#room-name');
        var modalConciliatorName = modalEdit.querySelector('#conciliator-name');

        modalSalaId.value = salaId;
        modalRoomName.value = salaName;
        modalConciliatorName.value = conciliadorId;
    });

    // Envío del modal por AJAX
    $('#salaForm').on('submit', function(e) {
        e.preventDefault();
        var formData = new FormData(this);
        $.ajax({
            url: '{% url "edit_sala" %}',  
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function(data) {
                $('#modalFormEdit').modal('hide'); // Cierra el modal después de la operación exitosa
                location.reload(); // Recarga la página para reflejar los cambios
            }
        });
    });
});


//coasas de alex
      document.querySelector('form[action="{% url "cancelar_pago" %}"]')
        ?.addEventListener("submit", function () {
          clearInterval(intervalId);
        });
    </script>
    <script
      src="https://kit.fontawesome.com/8ea13d36c9.js"
      crossorigin="anonymous"
    ></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.14/index.global.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.14/locales/es.global.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </body>
</html>